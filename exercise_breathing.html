<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙÙ‘Ø³ 4-7-8</title>
    <style>
        :root{
            --primary-color: #6C5CE7;
            --secondary-color:#A29BFE;
            --accent-color:#00CEC9;
            --success-color:#00B894;
            --danger-color:#D63031;
            --border-radius:12px;
        }
        body{font-family: "Segoe UI", Tahoma, Arial; padding:20px; background:#f7f7fb;}
        .timer-display{font-size:4rem; font-weight:700; color:var(--primary-color); margin-bottom:16px; min-height:80px; text-align:center;}
        .instruction-box{background:var(--secondary-color); color:#fff; padding:16px; border-radius:var(--border-radius); font-size:1.2rem; min-height:64px; display:flex; align-items:center; justify-content:center; text-align:center; transition:transform .2s, background-color .3s;}
        .breathing-cycle{margin-top:16px; padding:12px; border-radius:var(--border-radius); font-weight:700; color:#555; text-align:center; border:1px solid #eee;}
        button{cursor:pointer; border:0; padding:10px 18px; border-radius:10px; color:#fff; font-size:1rem;}
        .btn-danger{background:var(--danger-color)}
        .btn-accent{background:var(--accent-color)}
        .btn-primary{background:var(--primary-color)}
        /* Ù…Ø±Ø§Ø­Ù„ */
        .inhale{ background-color:#BBDEFB; color:var(--primary-color); transform:scale(1.03); }
        .hold{ background-color:#FFECB3; color:#E65100; transform:scale(1); }
        .exhale{ background-color:#CFD8DC; color:#455A64; transform:scale(.98); }
        .status-safe{ background:var(--success-color); color:#fff; }
    </style>
</head>
<body>
    <div style="max-width:720px;margin:0 auto;">
        <h2 style="text-align:center">ğŸ˜Š ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ‚ (4-7-8)</h2>

        <div style="background:#fff;padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);">
            <p>Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª: ØªÙ…Ø±ÙŠÙ† 4-7-8 Ù„Ø¹Ø¯Ø¯ <span id="totalCyclesLabel">4</span> Ø¯ÙˆØ±Ø§Øª. (Ø´Ù‡ÙŠÙ‚ 4 - Ø­Ø¬Ø² 7 - Ø²ÙÙŠØ± 8)</p>

            <div style="text-align:center;margin-top:18px;">
                <div id="timerDisplay" class="timer-display">1:16</div>
                <div id="instructionBox" class="instruction-box">Ø§Ø¶ØºØ· Ø§Ø¨Ø¯Ø£ Ù„Ù„Ø¨Ø¯Ø¡</div>

                <div style="margin-top:14px;">
                    <button id="startButton" class="btn-primary">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</button>
                </div>

                <div id="cycleDisplay" class="breathing-cycle" style="margin-top:12px;">Ø§Ù„Ø¯ÙˆØ±Ø©: 0 Ù…Ù† 4</div>
            </div>
        </div>
    </div>

<script>
    // Ø¹Ù†Ø§ØµØ±
    const startButton = document.getElementById('startButton');
    const timerDisplay = document.getElementById('timerDisplay');
    const instructionBox = document.getElementById('instructionBox');
    const cycleDisplay = document.getElementById('cycleDisplay');
    const totalCyclesLabel = document.getElementById('totalCyclesLabel');

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠÙ† (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)
    const INHALE_DURATION = 4;
    const HOLD_DURATION = 7;
    const EXHALE_DURATION = 8;
    const CYCLE_LENGTH = INHALE_DURATION + HOLD_DURATION + EXHALE_DURATION; // 19
    const TOTAL_CYCLES = 4;
    const TOTAL_DURATION = CYCLE_LENGTH * TOTAL_CYCLES; // 76

    totalCyclesLabel.textContent = TOTAL_CYCLES;

    // Ø­Ø§Ù„Ø©
    let elapsedSeconds = 0; // Ø«ÙˆØ§Ù†ÙŠ Ø§Ù†Ù‚Ø¶Øª Ù…Ù†Ø° Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    let intervalId = null;
    let isRunning = false;

    // ØªØ­ÙˆÙŠÙ„ Ø«ÙˆØ§Ù†ÙŠ Ø¥Ù„Ù‰ ØµÙŠØºØ© Ù…:ss
    function formatTime(totalSeconds){
        if (totalSeconds < 0) totalSeconds = 0;
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }

    // Ø­Ø¯Ù‘ÙØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ù‚Øª (ÙŠØ¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ)
    function updateTimerDisplay(remainingSeconds){
        timerDisplay.textContent = formatTime(remainingSeconds);
    }

    // Ø­Ø¯Ù‘ÙØ¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ elapsedSeconds) ÙˆØ­Ø¯Ù‘ÙØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function updatePhase(){
        if (elapsedSeconds >= TOTAL_DURATION) {
            finishExercise();
            return;
        }

        const timeInCycle = elapsedSeconds % CYCLE_LENGTH;
        const currentCycleIndex = Math.floor(elapsedSeconds / CYCLE_LENGTH);
        const currentCycleNumber = currentCycleIndex + 1;
        cycleDisplay.textContent = `Ø§Ù„Ø¯ÙˆØ±Ø©: ${currentCycleNumber} Ù…Ù† ${TOTAL_CYCLES}`;

        let phaseText = '';
        let phaseClass = '';
        let phaseDuration = 0;
        let timeInPhase = 0;

        if (timeInCycle < INHALE_DURATION) {
            phaseText = `Ø®Ø° Ù†ÙØ³Ø§Ù‹ (Ø´Ù‡ÙŠÙ‚)`;
            phaseClass = 'inhale';
            phaseDuration = INHALE_DURATION;
            timeInPhase = timeInCycle;
        } else if (timeInCycle < INHALE_DURATION + HOLD_DURATION) {
            phaseText = `Ø§Ø­Ø¨Ø³ (ÙƒØªÙ…)`;
            phaseClass = 'hold';
            phaseDuration = HOLD_DURATION;
            timeInPhase = timeInCycle - INHALE_DURATION;
        } else {
            phaseText = `Ø£Ø®Ø±Ø¬ Ø§Ù„Ù‡ÙˆØ§Ø¡ (Ø²ÙÙŠØ±)`;
            phaseClass = 'exhale';
            phaseDuration = EXHALE_DURATION;
            timeInPhase = timeInCycle - (INHALE_DURATION + HOLD_DURATION);
        }

        const remainingInPhase = phaseDuration - timeInPhase;
        // Ù†ØºÙŠÙ‘Ø± Ø§Ù„Ø£ØµÙ†Ø§Ù (classes) Ø¹Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„Ø£Ø«Ø± Ø§Ù„Ø¨ØµØ±ÙŠ
        instructionBox.className = 'instruction-box ' + phaseClass;
        instructionBox.textContent = `${phaseText} â€” ${remainingInPhase} Ø«Ø§Ù†ÙŠØ©`;
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
    function startExercise(){
        if (isRunning) return;
        isRunning = true;
        startButton.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
        startButton.className = 'btn-danger';

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø¯Ø¦ÙŠ
        updatePhase();
        updateTimerDisplay(TOTAL_DURATION - elapsedSeconds);

        intervalId = setInterval(() => {
            elapsedSeconds++;
            const remaining = TOTAL_DURATION - elapsedSeconds;
            updateTimerDisplay(remaining);
            updatePhase();

            if (remaining <= 0) {
                // Ø³ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ø¯Ø§Ø®Ù„ updatePhase/finishExercise
                clearInterval(intervalId);
                intervalId = null;
            }
        }, 1000);
    }

    // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª (pause)
    function pauseExercise(){
        if (!isRunning) return;
        isRunning = false;
        clearInterval(intervalId);
        intervalId = null;
        startButton.textContent = 'Ù…ØªØ§Ø¨Ø¹Ø©';
        startButton.className = 'btn-accent';
        instructionBox.className = 'instruction-box';
        instructionBox.textContent = 'ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª â€” Ø§Ø¶ØºØ· Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù';
    }

    // Ø¹Ù†Ø¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­
    function finishExercise(){
        clearInterval(intervalId);
        intervalId = null;
        isRunning = false;
        elapsedSeconds = 0; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù„Ø¨Ø¯Ø¡ ØªÙ…Ø±ÙŠÙ† Ø¬Ø¯ÙŠØ¯
        updateTimerDisplay(0);
        instructionBox.className = 'instruction-box status-safe';
        instructionBox.textContent = 'Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªÙ…Ø±ÙŠÙ† ğŸ‰';
        startButton.textContent = 'Ø£Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†';
        startButton.className = 'btn-primary';
        cycleDisplay.textContent = `Ø§Ù„Ø¯ÙˆØ±Ø©: ${TOTAL_CYCLES} Ù…Ù† ${TOTAL_CYCLES}`;
    }

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù†Ù‚Ø± Ø§Ù„Ø²Ø± (Ù†Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„Ø© isRunning ÙˆÙ„ÙŠØ³ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Øµ)
    startButton.addEventListener('click', () => {
        if (!isRunning) {
            // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù…ØªÙˆÙ‚ÙÙŠÙ† ÙˆÙ†Øµ Ø§Ù„Ø²Ø± "Ø£Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†" Ù†Ø¹ÙŠØ¯ ØªØ¹ÙŠÙŠÙ† elapsedSeconds Ø£ÙŠØ¶Ø§Ù‹
            if (startButton.textContent === 'Ø£Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†') {
                elapsedSeconds = 0;
            }
            startExercise();
        } else {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¹Ù…Ù„
            pauseExercise();
        }
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£ÙˆÙ„ÙŠ Ù„Ù„Ø¹Ø±Ø¶
    updateTimerDisplay(TOTAL_DURATION);
    cycleDisplay.textContent = `Ø§Ù„Ø¯ÙˆØ±Ø©: 0 Ù…Ù† ${TOTAL_CYCLES}`;
</script>
</body>
</html>
